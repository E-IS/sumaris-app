<form class="form-container" [formGroup]="form" (ngSubmit)="doSubmit($event)">
  <ion-grid>
    <!--Sample row code -->
    <ion-row>
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
        <ion-label>&nbsp;</ion-label>
      </ion-col>
      <ion-col>
        <mat-form-field>
          <input matInput #matInput
                 formControlName="label"
                 autocomplete="off"
                 type="text"
                 [textMask]="{mask: sampleRowMask, keepCharPositions: true, showMask: true, guide: true}"
                 placeholder="{{ 'PROGRAM.STRATEGY.SAMPLE_ROW_TITLE' | translate }}" >
        </mat-form-field>
      </ion-col>
    </ion-row>


    <!--EOTP -->
    <ion-row>
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
        <ion-label>&nbsp;</ion-label>
      </ion-col>
      <ion-col>
        <mat-autocomplete-field
          formControlName="analyticReference"
          [placeholder]="'PROGRAM.STRATEGY.ANALYTIC_REFERENCE'|translate"
          [config]="autocompleteFields.analyticReference"
          [tabindex]="tabindex+1">

          <button matAfter type="button" mat-icon-button
                  tabindex="-1"
                  [disabled]="!canFilterEotp"
                  [title]="'COMMON.BTN_FILTER'|translate"
                  (click)="toggleFilteredItems('eotp')"
                  [color]="enableEotpFilter ? 'primary' : undefined">
            <mat-icon>filter_list</mat-icon>
          </button>
        </mat-autocomplete-field>

      </ion-col>
    </ion-row>

    <!-- LABORATORIES -->
    <ion-row *ngFor="let strategyDepartmentForm of strategyDepartmentFormArray?.controls; index as i; first as first">
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
        <ion-label>&nbsp;</ion-label>
      </ion-col>
      <ion-col [formGroup]="strategyDepartmentHelper.at(i)">
        <mat-autocomplete-field
          formControlName="department"
          [placeholder]="('PROGRAM.STRATEGY.STRATEGY_DEPARTMENTS'|translate) + (i+1)"
          [config]="autocompleteFields.strategyDepartment"
          [tabindex]="tabindex+10+i*3"
          [required]="true">
          <button matAfter type="button" mat-icon-button
                  tabindex="-1"
                  [disabled]="!canFilterStrategyDepartment"
                  [title]="'COMMON.BTN_FILTER'|translate"
                  (click)="toggleFilteredItems('strategyDepartment')"
                  [color]="enableStrategyDepartmentFilter ? 'primary' : undefined">
            <mat-icon>filter_list</mat-icon>
          </button>
        </mat-autocomplete-field>
      </ion-col>

      <ion-col size="auto" class="ion-align-self-center">
        <button matAfter type="button" mat-icon-button
                [tabindex]="tabindex+10++i*3+1"
                [title]="'COMMON.BTN_ADD'|translate"
                (click)="addStrategyDepartment()">
          <mat-icon>add</mat-icon>
        </button>

        <button matAfter type="button" mat-icon-button
                [tabindex]="tabindex+10++i*3+2"
                [title]="'COMMON.BTN_DELETE'|translate"
                (click)="strategyDepartmentHelper.removeAt(i)">
          <mat-icon>close</mat-icon>
        </button>
      </ion-col>

    </ion-row>

    <!--FISHING AREA -->
    <ion-row *ngFor="let fishingAreaForm of appliedStrategiesForm?.controls; index as i; first as first">
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
        <ion-label>&nbsp;</ion-label>
      </ion-col>
      <ion-col [formGroup]="appliedStrategiesHelper.at(i)">
        <mat-autocomplete-field
          formControlName="location"
          [placeholder]="('PROGRAM.STRATEGY.APPLIED_STRATEGIES'|translate) + (i+1)"
          [config]="autocompleteFields.appliedStrategy"
          [tabindex]="tabindex+10+i*3"
          [required]="true">
          <button matAfter type="button" mat-icon-button
                  tabindex="-1"
                  [disabled]="!canFilterAppliedStrategy"
                  [title]="'COMMON.BTN_FILTER'|translate"
                  (click)="toggleFilteredItems('appliedStrategy')"
                  [color]="enableAppliedStrategyFilter ? 'primary' : undefined">
            <mat-icon>filter_list</mat-icon>
          </button>
        </mat-autocomplete-field>
      </ion-col>

      <ion-col size="auto" class="ion-align-self-center">
        <button matAfter type="button" mat-icon-button
                [tabindex]="tabindex+10++i*3+1"
                [title]="'COMMON.BTN_ADD'|translate"
                (click)="addAppliedStrategy()">
          <mat-icon>add</mat-icon>
        </button>

        <button matAfter type="button" mat-icon-button
                [tabindex]="tabindex+10++i*3+2"
                [title]="'COMMON.BTN_DELETE'|translate"
                (click)="appliedStrategiesHelper.removeAt(i)">
          <mat-icon>close</mat-icon>
        </button>
      </ion-col>

    </ion-row>

    <!-- Target species (using metier) -->
    <ion-row *ngFor="let taxonNameForm of taxonNamesForm?.controls; index as i; first as first">
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
        <ion-label>&nbsp;</ion-label>
      </ion-col>
      <ion-col [formGroup]="taxonNameHelper.at(i)">
        <mat-autocomplete-field
          formControlName="taxonName"
          [placeholder]="('PROGRAM.STRATEGY.TAXON_NAMES'|translate)"
          [config]="autocompleteFields.taxonName"
          [tabindex]="tabindex+10+i*3"
          [required]="true">
          <button matAfter type="button" mat-icon-button
                  tabindex="-1"
                  [disabled]="!canFilterTaxonName"
                  [title]="'COMMON.BTN_FILTER'|translate"
                  (click)="toggleFilteredItems('taxonName')"
                  [color]="enableTaxonNameFilter ? 'primary' : undefined">
            <mat-icon>filter_list</mat-icon>
          </button>
        </mat-autocomplete-field>
      </ion-col>

    </ion-row>

    <!-- <ion-row *ngFor="let taxonNameForm of taxonNamesForm?.controls; index as i; first as first">
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
        <ion-label>&nbsp;</ion-label>
      </ion-col>
        <ion-col [formGroup]="taxonNameHelper.at(i)">
        <mat-autocomplete-field formControlName="name"
                                [placeholder]="'PROGRAM.STRATEGY.TAXON_NAMES'|translate"
                                [config]="autocompleteFields.taxonName"
                                [tabindex]="tabindex+1"
                                [required]="true"
                                [noResultMessage]="'TRIP.OPERATION.EDIT.NO_TARGET_SPECIES_FOUND'">
          <button matAfter type="button" mat-icon-button
                  tabindex="-1"
                  [disabled]="!canFilterTaxonName"
                  [title]="'COMMON.BTN_FILTER'|translate"
                  (click)="toggleFilteredItems('taxonName')"
                  [color]="enableTaxonNameFilter ? 'primary' : undefined">
            <mat-icon>filter_list</mat-icon>
          </button>
        </mat-autocomplete-field>
      </ion-col>
    </ion-row> -->


    <!--year -->
    <ion-row>
      <ion-col size="12" size-md="2" size-lg="3">
        <ion-label>&nbsp;</ion-label>
      </ion-col>
      <ion-col size="12" size-sm="auto">
        <mat-date-short-field [placeholder]="'PROGRAM.STRATEGY.YEAR'|translate"
                              formControlName="year"
                              [required]="true" >
        </mat-date-short-field>
      </ion-col>
    </ion-row>

    <!--quarters-->
    <ion-row>
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
      </ion-col>
      <ion-col>
        <mat-error *ngIf="form.touched && form.get('appliedPeriods').hasError('minLength')">
          {{'PROGRAM.STRATEGY.ERROR.EFFORT.MIN_LENGTH' | translate: form.get('appliedPeriods').errors.minLength }}
        </mat-error>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="12" size-md="2" size-lg="3">
        <ion-label class="ion-float-end" translate>PROGRAM.STRATEGY.EFFORT</ion-label>
      </ion-col>

      <ion-col size="1" class="ion-margin" *ngFor="let appliedPeriodForm of appliedPeriodsForm?.controls; index as i; first as first">
        <mat-form-field [formGroup]="appliedPeriodHelper.at(i)">
          <input matInput
          formControlName="acquisitionNumber"
          type="number"
          step="1"
          min="0"
          autocomplete="off"
          [placeholder]="'PROGRAM.STRATEGY.QUARTER_' + (i+1) |translate">
        </mat-form-field>
      </ion-col>
    </ion-row>


    <ion-row>
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
        <h2>
          <ion-label class="ion-float-end" translate>PROGRAM.STRATEGY.PARAMETERS_TITLE</ion-label>
        </h2>
      </ion-col>
    </ion-row>

    <!-- Weight Pmfms -->
    <!-- <ion-item *ngIf="form.controls.pmfmStrategies.invalid && (form.touched)" hidden-xs hidden-sm hidden-mobile lines="none">
      <div *ngIf="form.controls.pmfmStrategies.errors.required">
        Name is required.
      </div>
    </ion-item> -->
    <!-- <ion-item *ngIf="form.controls.pmfmStrategies.invalid && (form.touched)" lines="none">
      <ion-icon color="danger" slot="start" name="alert-circle"></ion-icon>
      <ion-label color="danger" [innerHTML]="error|translate"></ion-label>
    </ion-item> -->
    <ion-row>
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
      </ion-col>
      <ion-col>
        <mat-error *ngIf="form.touched && form.get('pmfmStrategies').hasError('minLength')">
          {{'PROGRAM.STRATEGY.ERROR.PARAMETERS.MIN_LENGTH' | translate: form.get('pmfmStrategies').errors.minLength }}
        </mat-error>
        <mat-error *ngIf="form.touched && form.get('pmfmStrategies').hasError('weightOrSize')">
          {{'PROGRAM.STRATEGY.ERROR.PARAMETERS.WEIGHT_OR_SIZE' | translate}}
        </mat-error>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
        <ion-label class="ion-float-end" translate>PROGRAM.STRATEGY.WEIGHT</ion-label>
      </ion-col>
      <ion-col>
        <ion-card class="ion-no-margin">
          <app-pmfm-strategies-table
                                     #weightPmfmStrategiesTable
                                     [title]=""
                                     [program]="program"
                                     [canEdit]="enabled"
                                     [canDelete]="enabled"
                                     [canDisplayToolbar]="false"
                                     [canDisplayColumnsHeaders]="false"
                                     [canDisplaySimpleStrategyValidators]="true"
                                     pmfmFilterApplied="weight"
                                     [initializeOneRow]="true"
                                     [sticky]="true"
                                     [showPMFMDetailsColumns]="true">
          </app-pmfm-strategies-table>
        </ion-card>
      </ion-col>
    </ion-row>
    <ion-row style="height: 15px"></ion-row>

    <!-- Size Pmfms -->
    <ion-row>
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
        <ion-label class="ion-float-end" translate>PROGRAM.STRATEGY.SIZE</ion-label>
      </ion-col>
      <ion-col>
        <ion-card class="ion-no-margin">
          <app-pmfm-strategies-table #sizePmfmStrategiesTable
                                     [title]=""
                                     [program]="program"
                                     [canEdit]="enabled"
                                     [canDelete]="enabled"
                                     [canDisplayToolbar]="false"
                                     [canDisplayColumnsHeaders]="false"
                                     [canDisplaySimpleStrategyValidators]="true"
                                     pmfmFilterApplied="size"
                                     [initializeOneRow]="true"
                                     [sticky]="true"
                                     [showPMFMDetailsColumns]="true">
          </app-pmfm-strategies-table>
        </ion-card>
      </ion-col>
    </ion-row>
    <ion-row style="height: 15px"></ion-row>

    <!--SEX -->
        <ion-row>
          <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
            <ion-label>&nbsp;</ion-label>
          </ion-col>
          <ion-col size="12" size-sm="auto">
           <mat-boolean-field [placeholder]="'PROGRAM.STRATEGY.SEX'|translate" [formControl]="pmfmStrategiesHelper.at(0)" [required]="true">-->
            </mat-boolean-field>
          </ion-col>
        </ion-row>

    <!-- Maturity Pmfms -->
    <ion-row [hidden]="!ifSex()">
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
        <ion-label class="ion-float-end" translate>PROGRAM.STRATEGY.MATURITY</ion-label>
      </ion-col>
      <ion-col>
        <ion-card class="ion-no-margin">
          <app-pmfm-strategies-table #maturityPmfmStrategiesTable
                                     [title]=""
                                     [program]="program"
                                     [canEdit]="enabled"
                                     [canDelete]="enabled"
                                     [canDisplayToolbar]="false"
                                     [canDisplayColumnsHeaders]="false"
                                     [canDisplaySimpleStrategyValidators]="true"
                                     pmfmFilterApplied="maturity"
                                     [initializeOneRow]="true"
                                     [sticky]="true"
                                     [showPMFMDetailsColumns]="true">
          </app-pmfm-strategies-table>
        </ion-card>
      </ion-col>
    </ion-row>
    <ion-row style="height: 15px"></ion-row>

    <!-- AGE -->
        <ion-row>
          <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
            <ion-label>&nbsp;</ion-label>
          </ion-col>
          <ion-col size="12" size-sm="auto">
            <mat-boolean-field [placeholder]="'PROGRAM.STRATEGY.AGE'|translate" [formControl]="pmfmStrategiesHelper.at(1)" [required]="true" >
            </mat-boolean-field>
          </ion-col>
        </ion-row>

    <!-- Calcified Pmfms -->
    <ion-row [hidden]="!ifAge()" *ngFor="let pmfmStrategiesFraction of pmfmStrategiesFractionForm?.controls; index as i; first as first">
      <ion-col size="0" size-md="2" size-lg="3" class="ion-no-padding">
        <ion-label>&nbsp;</ion-label>
      </ion-col>
      <ion-col>
        <mat-autocomplete-field
          [formControl]="PmfmStrategiesFractionHelper.at(i)"
          [placeholder]="('PROGRAM.STRATEGY.CALCIFIED_TYPE'|translate) + (i+1)"
          [appAutofocus]="PmfmStrategiesFractionFocusIndex === i"
          [config]="autocompleteFields.pmfmStrategiesFraction"
          [tabindex]="tabindex+10+i*3"
          [required]="false">
          <button matAfter type="button" mat-icon-button
                  tabindex="-1"
                  [disabled]="!canFilterPmfmStrategiesFraction"
                  [title]="'COMMON.BTN_FILTER'|translate"
                  (click)="toggleFilteredItems('pmfmStrategiesFraction')"
                  [color]="enablePmfmStrategiesFractionFilter ? 'primary' : undefined">
            <mat-icon>filter_list</mat-icon>
          </button>

        </mat-autocomplete-field>
      </ion-col>

      <ion-col size="auto" class="ion-align-self-center">

        <button matAfter type="button" mat-icon-button
                [tabindex]="tabindex+10++i*3+1"
                [title]="'COMMON.BTN_ADD'|translate"
                (click)="addPmfmStrategiesFraction()">
          <mat-icon>add</mat-icon>
        </button>

        <button type="button" mat-icon-button
                [tabindex]="tabindex+10++i*3+2"
                [title]="'COMMON.BTN_DELETE'|translate"
                (click)="PmfmStrategiesFractionHelper.removeAt(i)">
          <mat-icon>close</mat-icon>
        </button>

      </ion-col>

    </ion-row>



    <!--comment-->
    <ion-row>
      <ion-col>
        <mat-form-field appearance="outline">
        <textarea matInput #comments matTextareaAutosize="true" matAutosizeMinRows="4" maxlength="255"
                  [placeholder]="'COMMON.COMMENTS'|translate"
                  formControlName="description" ></textarea>
          <mat-hint align="end">{{comments.value.length}} / 255</mat-hint>
        </mat-form-field>
      </ion-col>
    </ion-row>
  </ion-grid>
</form>
