<ng-container *ngIf="!autocomplete">
  <!-- readonly -->
  <mat-form-field *ngIf="readonly">
    <input matInput hidden type="text" readonly="true" [formControl]="formControl">
    <ion-label>{{ displayWith(value) }}</ion-label>
  </mat-form-field>

  <!-- Basic select -->
  <mat-form-field *ngIf="!readonly" [floatLabel]="floatLabel">

    <div matPrefix><ng-content select="[matPrefix]"></ng-content></div>

    <mat-select #matInput
                [placeholder]="placeholder"
                [formControl]="formControl"
                (blur)="onBlur.emit($event)"
                (focus)="_onFocus($event)"
                [tabindex]="_tabindex"
                [required]="required">
      <mat-select-trigger>{{ displayWith(value) }}</mat-select-trigger>

      <!-- header -->
      <ion-row class="mat-autocomplete-header ion-no-padding">
        <ion-col *ngFor="let attr of displayAttributes; index as i;" [size]="displayColumnSizes[i]" >
          <ion-text [innerHTML]="displayColumnNames[i] | translate"></ion-text>
        </ion-col>
      </ion-row>

      <!-- None option -->
      <mat-option *ngIf="!required" class="ion-no-padding">
        <ion-row class="ion-no-padding">
          <ion-col class="ion-no-padding">
            <ion-label><i translate>COMMON.EMPTY_OPTION</i></ion-label>
          </ion-col>
        </ion-row>
      </mat-option>

      <!-- options -->
      <mat-option *ngFor="let item of $items | async" [value]="item" class="ion-no-padding">
        <ion-row >
          <ion-col *ngFor="let attr of displayAttributes; index as i;"
                   [size]="displayColumnSizes[i]">
            <ion-text [innerHTML]="getPropertyByPath(item, attr) | highlight: {search: formControl.value }"></ion-text>
          </ion-col>
        </ion-row>
      </mat-option>
    </mat-select>

    <button matSuffix mat-icon-button tabindex="-1"
            type="button"
            (click)="enableAutocomplete($event)"
            [hidden]="formControl.disabled">
      <mat-icon>search</mat-icon>
    </button>
    <button matSuffix mat-icon-button tabindex="-1"
            type="button"
            *ngIf="clearable"
            (click)="writeValue(null) || $event.stopPropagation()"
            [hidden]="formControl.disabled || !formControl.value">
      <mat-icon>close</mat-icon>
    </button>
    <ng-content matSuffix select="[matSuffix]"></ng-content>

    <mat-error *ngIf="formControl.hasError('required')" translate>ERROR.FIELD_REQUIRED</mat-error>
    <mat-error *ngIf="formControl.hasError('entity')" translate>ERROR.FIELD_INVALID</mat-error>
  </mat-form-field>
</ng-container>

<!-- Filterable -->
<mat-form-field *ngIf="autocomplete" [floatLabel]="floatLabel">

  <div matPrefix><ng-content select="[matPrefix]"></ng-content></div>

  <!--
    NOTE :
     - "selectInputContent($event) || onFocus.emit($event)" : call onFocus only when to the input is empty (nothing to select)
  -->
  <input matInput #matInput type="text"
         [matAutocomplete]="autoCombo"
         [formControl]="formControl"
         [placeholder]="placeholder"
         [appAutofocus]="appAutofocus"
         [tabindex]="_tabindex"
         [readonly]="readonly"
         [required]="required"
         (click)="onClick.emit($event)"
         (blur)="onBlur.emit($event)"
         (focus)="_onFocus($event)"
         (keyup.arrowdown)="formControl.enabled && !autoCombo.showPanel && onDropButtonClick.emit($event)">


  <button mat-button matSuffix mat-icon-button tabindex="-1"
          type="button"
          (click)="onDropButtonClick.emit($event)"
          [hidden]="formControl.disabled">
    <mat-icon>arrow_drop_down</mat-icon>
  </button>
  <button matSuffix mat-icon-button tabindex="-1"
          type="button"
          *ngIf="clearable"
          (click)="writeValue(null) || $event.stopPropagation()"
          [hidden]="formControl.disabled || !formControl.value">
    <mat-icon>close</mat-icon>
  </button>
  <ng-content matSuffix select="[matSuffix]"></ng-content>

  <mat-error *ngIf="formControl.hasError('required')" translate>ERROR.FIELD_REQUIRED</mat-error>
  <mat-error *ngIf="formControl.hasError('entity')||formControl.hasError('object')" translate>ERROR.FIELD_INVALID</mat-error>

  <!-- combo -->
  <mat-autocomplete #autoCombo="matAutocomplete"
                    autoActiveFirstOption
                    [displayWith]="displayWith"
                    [class]="classList">
    <ng-container *ngIf="$items | async as items">
      <ion-row class="mat-autocomplete-header ion-no-padding" *ngIf="items.length">
        <ion-col *ngFor="let attr of displayAttributes; index as i;" [size]="displayColumnSizes[i]" >
          <ion-text [innerHTML]="displayColumnNames[i] | translate"></ion-text>
        </ion-col>
      </ion-row>

      <mat-option *ngFor="let item of items" [value]="item" class="ion-no-padding">
        <ion-row>
          <ion-col *ngFor="let attr of displayAttributes; index as i;"
                   [size]="displayColumnSizes[i]">
            <ion-text [innerHTML]="getPropertyByPath(item, attr) | highlight: {search: formControl.value }"></ion-text>
          </ion-col>
        </ion-row>
      </mat-option>
    </ng-container>
  </mat-autocomplete>
</mat-form-field>

