<app-toolbar visible-xs visible-sm visible-mobile>
  <ion-button mat-icon-button [matMenuTriggerFor]="matmenu">
    <mat-icon slot="icon-only">public</mat-icon>
  </ion-button>
</app-toolbar>

<!-- change locale menu -->
<mat-menu #matmenu="matMenu">
  <button mat-menu-item (click)="changeLanguage('en')">
    <mat-icon>flag</mat-icon>
    <ion-label>
      English
    </ion-label>
  </button>
  <button mat-menu-item (click)="changeLanguage('fr')">
    <mat-icon>flag</mat-icon>
    <ion-label>
      Fran√ßais
    </ion-label>
  </button>
</mat-menu>

<ion-content [ngStyle]="contentStyle"
             no-padding-xs>
    <!-- loading spinner -->
    <div class="loading-page" [class.hidden]="!loading">
      <div class="spinner" *ngIf="loading && showSpinner">
        <p>Loading...</p>
        <div class="sk-cube1 sk-cube"></div>
        <div class="sk-cube2 sk-cube"></div>
        <div class="sk-cube4 sk-cube"></div>
        <div class="sk-cube3 sk-cube"></div>
      </div>
    </div>

    <!-- Desktop: translucent top toolbar -->
    <div hidden-xs hidden-sm hidden-mobile>
      <ion-toolbar translucent>
        <ion-buttons slot="start">
          <ion-menu-toggle>
            <ion-button color="light" fill="clear">
              <ion-icon slot="icon-only" name="menu"></ion-icon>
            </ion-button>
          </ion-menu-toggle>
        </ion-buttons>

        <ion-buttons slot="end">
          <!-- change locale button -->
          <ion-button color="secondary" fill="solid" [matMenuTriggerFor]="matmenu">
            <mat-icon slot="start">public</mat-icon>
            <ion-label>&nbsp;{{ currentLocaleCode | uppercase }}</ion-label>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </div>

    <!-- Welcome card -->
    <ion-card @fadeInAnimation *ngIf="!loading" align-self-center text-center padding class="welcome">
      <ion-card-header>
        <ion-card-title [innerHTML]="'HOME.WELCOME'|translate: {appName: appName}" text-center>
        </ion-card-title>
        <ion-card-subtitle [innerHTML]="description">
        </ion-card-subtitle>
      </ion-card-header>
      <ion-card-content no-padding>
        <ion-text color="primary">
          <img class="logo" src="{{ logo }}"/>
        </ion-text>
        <ion-text *ngIf="!isLogin">
          <br/>
          <span translate>HOME.REGISTER_HELP</span>
        </ion-text>
      </ion-card-content>

      <ion-footer padding-top>

        <ion-button expand="block" color="primary" *ngIf="!isLogin" (click)="register()">
          <span translate>HOME.BTN_REGISTER</span>
        </ion-button>

        <ion-button expand="block" color="light" [routerLink]="['/account']" *ngIf="!isLogin">
          <span translate>AUTH.BTN_LOGIN</span>
        </ion-button>

        <ion-button expand="block" color="secondary" [routerLink]="['/account']" *ngIf="isLogin">
          <ion-icon name="contact" slot="start"></ion-icon>
          <span translate>HOME.BTN_MY_ACCOUNT</span>
        </ion-button>

        <p *ngIf="isLogin" hidden-xs hidden-sm hidden-mobile>
          <ion-text [innerHTML]="'HOME.NOT_THIS_ACCOUNT_QUESTION' | translate: {displayName: displayName}"></ion-text>
          <br/>
          <ion-text>
            <a href="#" (click)="logout($event)">
              <span translate>HOME.BTN_DISCONNECT</span>
            </a>
          </ion-text>
        </p>
      </ion-footer>
    </ion-card>

  <ion-grid *ngIf="!loading && pageHistory.length; else bottomBanner"
            class="history-container" align-self-center>
    <ion-row>
      <ion-col size="12" size-xl="" *ngFor="let page of pageHistory; trackBy: getPagePath"
               text-center>
        <ion-card text-start align-self-start @fadeInAnimation>
          <ion-card-header no-padding>
            <!-- top bar -->
            <ion-card-subtitle>
              <button type="button" tabindex="-1"
                      (click)="localSettingsService.removeHistory(page.path)"
                      mat-icon-button float-start no-margin>
                <mat-icon>close</mat-icon>
              </button>
              <ion-label [innerHTML]="page.subtitle"></ion-label>
              <ion-label float-end [title]="page.time|dateFormat:{time: true}">
                <ion-icon name="time"></ion-icon> {{ page.time|dateFromNow }}
              </ion-label>
            </ion-card-subtitle>

            <!-- main page -->
            <ion-card-title no-margin>
              <ion-item  detail="true"
                         tappable class="text-1x"
                         [routerLink]="page.path"
                         routerDirection="forward" lines="none">
                <ion-icon color="primary" [name]="page.icon" slot="start"></ion-icon>
                <ion-label color="primary" [innerHTML]="page.title"></ion-label>
              </ion-item>
            </ion-card-title>
          </ion-card-header>

          <!-- children pages -->
          <ion-card-content no-padding padding-start *ngIf="page.children?.length">
            <ion-list no-padding>
              <ion-item  detail="true"
                         *ngFor="let childPage of page.children"
                         tappable class="text-1x"
                        [routerLink]="childPage.path"
                        routerDirection="forward">
                <ion-icon [name]="childPage.icon" slot="start"></ion-icon>
                <ion-label color="dark" [innerHTML]="childPage.title"></ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Display configured Departments logos -->
  <ng-template #bottomBanner>
    <div class="bottom-banner" *ngIf="!loadingBanner" @fadeInAnimation
      text-center padding>
      <a href="{{ item.siteUrl }}" *ngFor="let item of partners | async ">
        <img class="logo" src="{{ item.logo }}" alt="{{item.label}}"  [title]="item.label" />
      </a>
    </div>
  </ng-template>

</ion-content>
